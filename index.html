<html>

<head>
    <title>å›½åœŸåœ°ç†é™¢ æµ¸æ°´æ¨å®šå›³+æ´ªæ°´æµ¸æ°´æƒ³å®šåŒºåŸŸ</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src='https://unpkg.com/maplibre-gl@3.1.0/dist/maplibre-gl.js'></script>
    <link href='https://unpkg.com/maplibre-gl@3.1.0/dist/maplibre-gl.css' rel='stylesheet' />
    <!--<script src='maplibre-gl-gsi-terrain.js'></script>-->
    <script type="module" src="maplibre-gl-gsi-terrain-fast-png.js"></script>
    <script src="https://unpkg.com/pmtiles@2.7.0/dist/index.js"></script>
    <style>
        body {
            margin: 0;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        .map-overlay {
            font: bold 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            position: absolute;
            width: 220px;
            bottom: 20px;
            left: 0;
            padding: 10px;
        }

        .map-overlay .map-overlay-inner {
            background-color: #fff;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            border-radius: 3px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .map-overlay label {
            display: block;
            margin: 0 0 0px;
            font-size: 12px;
            top: 100px;
            left: 10px;
            display: block;
            margin-bottom: 5px;
        }

        .map-overlay input {
            background-color: transparent;
            display: inline-block;
            width: 100%;
            position: relative;
            margin: 0;
            cursor: ew-resize;
        }

        .maplibregl-popup .maplibregl-popup-content {
            padding: 8px 10px;
            font: 12px/14px Arial, Helvetica, sans-serif;
            color: black;
            background: white;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
            border-radius: 5px;
            width: 200px;
            height: auto;
        }

        .legend-png {
            position: absolute;
            bottom: 210px;
            right: 10px;
            z-index: 1;
            background: white;
            padding: 5px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            width: fit-content;
        }

        .image-container {
            display: flex;
            justify-content: center;
        }

        .legend-png img {
            width: 80px;
            height: 200px;
        }

        .legend {
            background-color: rgba(255, 255, 255, 1);
            border-radius: 3px;
            bottom: 50px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font: 12px/14px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            padding: 10px;
            position: absolute;
            right: 10px;
            z-index: 1;
            line-height: 12px;
            height: 130px;
        }

        .legend h4 {
            margin: 0 0 10px;
        }

        .legend div span {
            border-radius: 50%;
            display: inline-block;
            height: 15px;
            margin-right: 10px;
            width: 15px;
            color: orangered
        }

        .square {
            width: 10px;
            height: 10px;
        }

        #select-pngtiles {
            padding: 3px 4px;
            font: 12px/14px Arial, Helvetica, sans-serif;
            color: black;
            background: white;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            width: 300px;
            position: absolute;
            top: 5px;
            z-index: 10;
        }

        #pngtiles {
            width: 100%;
            box-sizing: border-box;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div id="select-pngtiles">
        <label><b>æµ¸æ°´æ¨å®šå›³ã®ç¨®é¡</b></label><br>
        <select id="pngtiles" onchange="SelectPngTiles()">
            <!--å¹³æˆ30å¹´7æœˆè±ªé›¨-->
            <option value="201807H3007gouu_takahashigawa_dansaizu">å¹³æˆ30å¹´7æœˆè±ªé›¨ æµ¸æ°´æ¨å®šæ®µå½©å›³ï¼ˆç©ºä¸­å†™çœŸåˆ¤èª­ç‰ˆï¼‰ é«˜æ¢å·ï¼ˆå²¡å±±çœŒå€‰æ•·å¸‚ãªã©ï¼‰</option>
            <option value="201807H3007gouu_hijikawa_dansaizu">å¹³æˆ30å¹´7æœˆè±ªé›¨ æµ¸æ°´æ¨å®šæ®µå½©å›³ï¼ˆç©ºä¸­å†™çœŸåˆ¤èª­ç‰ˆï¼‰ è‚±å·ï¼ˆæ„›åª›çœŒå¤§æ´²å¸‚ãªã©ï¼‰</option>
            <!--ä»¤å’Œå…ƒå¹´å°é¢¨ç¬¬19å·-->
            <option value="20191012typhoon19_naruse_1014dansaizu">ä»¤å’Œå…ƒå¹´å°é¢¨ç¬¬19å· æµ¸æ°´æ¨å®šæ®µå½©å›³ é³´ç€¬å·æ°´ç³»ï¼ˆå‰ç”°å·ï¼‰</option>
            <option value="20191012typhoon19_abukuma_1014dansaizu">ä»¤å’Œå…ƒå¹´å°é¢¨ç¬¬19å· æµ¸æ°´æ¨å®šæ®µå½©å›³ é˜¿æ­¦éšˆå·æ°´ç³»ï¼ˆé˜¿æ­¦éšˆå·ï¼‰</option>
            <option value="20191012typhoon19_shinano_1013dansaizu">ä»¤å’Œå…ƒå¹´å°é¢¨ç¬¬19å· æµ¸æ°´æ¨å®šæ®µå½©å›³ ä¿¡æ¿ƒå·æ°´ç³»ï¼ˆåƒæ›²å·ï¼‰</option>
            <option value="20191012typhoon19_kuji_1014dansaizu">ä»¤å’Œå…ƒå¹´å°é¢¨ç¬¬19å· æµ¸æ°´æ¨å®šæ®µå½©å›³ ä¹…æ…ˆå·æ°´ç³»ï¼ˆä¹…æ…ˆå·ï¼‰</option>
            <option value="20191012typhoon19_naka_1014dansaizu">ä»¤å’Œå…ƒå¹´å°é¢¨ç¬¬19å· æµ¸æ°´æ¨å®šæ®µå½©å›³ é‚£ç‚å·æ°´ç³»ï¼ˆé‚£ç‚å·ï¼‰</option>
            <option value="20191012typhoon19_arakawa_1014dansaizu">ä»¤å’Œå…ƒå¹´å°é¢¨ç¬¬19å· æµ¸æ°´æ¨å®šæ®µå½©å›³ è’å·æ°´ç³»ï¼ˆå…¥é–“å·ãƒ»è¶Šè¾ºå·ãƒ»éƒ½å¹¾å·ï¼‰</option>
            <!--ä»¤å’Œå…ƒå¹´10æœˆã®ä½æ°—åœ§ã«ä¼´ã†å¤§é›¨-->
            <option value="20191025oame_mobara_1028dansaizu_handoku">ä»¤å’Œå…ƒå¹´10æœˆã®ä½æ°—åœ§ã«ä¼´ã†å¤§é›¨ æµ¸æ°´æ¨å®šæ®µå½©å›³ ç©ºä¸­å†™çœŸåˆ¤èª­ç‰ˆ
                ä¸€å®®å·æ°´ç³»ï¼ˆä¸€å®®å·ãƒ»è±Šç”°å·ãƒ»é˜¿ä¹…å·ï¼‰èŒ‚åŸé§…å‘¨è¾º</option>
            <!--ä»¤å’Œ2å¹´7æœˆè±ªé›¨-->
            <option value="20200703oame_kumagawahitoyoshi_0704dansaizu">ä»¤å’Œ2å¹´7æœˆè±ªé›¨ æµ¸æ°´æ¨å®šå›³ çƒç£¨å·æ°´ç³»çƒç£¨å·ã€€äººå‰å¸‚å‘¨è¾ºï¼ˆ2020å¹´7æœˆ4æ—¥13æ™‚ä½œæˆï¼‰
            </option>
            <option value="20200703oame_kumagawa_0704dansaizu">ä»¤å’Œ2å¹´7æœˆè±ªé›¨ æµ¸æ°´æ¨å®šå›³ çƒç£¨å·æ°´ç³»çƒç£¨å·ï¼ˆ2020å¹´7æœˆ4æ—¥20æ™‚ä½œæˆï¼‰</option>
            <option value="20200703oame_sashikigawayunouragawaashikita_0704dansaizu">ä»¤å’Œ2å¹´7æœˆè±ªé›¨
                æµ¸æ°´æ¨å®šå›³ä½æ•·å·åŠã³æ¹¯æµ¦å·æµåŸŸã€€èŠ¦åŒ—ç”ºå‘¨è¾ºï¼ˆ2020å¹´7æœˆ4æ—¥22æ™‚ä½œæˆï¼‰</option>
            <option value="20200703oame_omuta_0707dansaizu">ä»¤å’Œ2å¹´7æœˆè±ªé›¨ æµ¸æ°´æ¨å®šå›³ å¤§ç‰Ÿç”°å¸‚å‘¨è¾ºï¼ˆ2020å¹´7æœˆ7æ—¥9æ™‚ä½œæˆï¼‰</option>
            <option value="20200703oame_hita_0707dansaizu">ä»¤å’Œ2å¹´7æœˆè±ªé›¨ æµ¸æ°´æ¨å®šå›³ ç­‘å¾Œå·æ°´ç³»èŠ±æœˆå·ã€€æ—¥ç”°å¸‚å‹ç”°å‘¨è¾ºï¼ˆ2020å¹´7æœˆ7æ—¥14æ™‚ä½œæˆï¼‰</option>
            <option value="20200703oame_miyama_0708dansaizu">ä»¤å’Œ2å¹´7æœˆè±ªé›¨ æµ¸æ°´æ¨å®šå›³ çŸ¢éƒ¨å·æ°´ç³»çŸ¢éƒ¨å·ã€€ã¿ã‚„ã¾å¸‚å‘¨è¾ºï¼ˆ2020å¹´7æœˆ8æ—¥9æ™‚ä½œæˆï¼‰</option>
            <option value="20200703oame_chikugogawa_0709dansaizu">ä»¤å’Œ2å¹´7æœˆè±ªé›¨ æµ¸æ°´æ¨å®šå›³ ç­‘å¾Œå·æ°´ç³»ç­‘å¾Œå·ç¬¬2å ±ï¼ˆ2020å¹´7æœˆ9æ—¥18æ™‚ä½œæˆï¼‰</option>
            <option value="20200729rain_mogamigawa_0729dansaizu2">ä»¤å’Œ2å¹´7æœˆè±ªé›¨ æµ¸æ°´æ¨å®šå›³ æœ€ä¸Šå·æ°´ç³»æœ€ä¸Šå·ï¼ˆ2020å¹´7æœˆ29æ—¥20æ™‚ä½œæˆï¼‰</option>
            <!--ä»¤å’Œ5å¹´6æœˆ29æ—¥ã‹ã‚‰ã®å¤§é›¨-->
            <option value="20230629rain_0711shinsui">ä»¤å’Œ5å¹´6æœˆ29æ—¥ã‹ã‚‰ã®å¤§é›¨ æµ¸æ°´æ¨å®šå›³ ç­‘å¾Œå·æ°´ç³» ç­‘å¾Œå·</option>
        </select>
    </div>
    <div class="legend-png">
        <div class="image-container">
            <img src="201807H3007gouu_dansaizu.png" alt="Legend">
        </div>
    </div>
    <div id="legend-flood_l2_shinsuishin" style="display:block;" class='legend'>
        <h4>æ´ªæ°´æµ¸æ°´æƒ³å®šåŒºåŸŸ<br>(æƒ³å®šæœ€å¤§è¦æ¨¡)</h4>
        <div class="square" style='background-color: rgb(220, 122, 220); display: inline-block;'>
        </div><span style="display: inline-block; margin-left: 5px;">20.0mä»¥ä¸Š</span><br>
        <div class="square" style='background-color: rgb(242, 133, 201); display: inline-block;'>
        </div><span style="display: inline-block; margin-left: 5px;">10.0 ï½ 20.0m</span><br>
        <div class="square" style='background-color: rgb(255, 145, 145); display: inline-block;'>
        </div><span style="display: inline-block; margin-left: 5px;">5.0 ï½ 10.0m</span><br>
        <div class="square" style='background-color: rgb(255, 183, 183); display: inline-block;'>
        </div><span style="display: inline-block; margin-left: 5px;">3.0 ï½ 5.0m</span><br>
        <div class="square" style='background-color: rgb(255, 216, 192); display: inline-block;'>
        </div><span style="display: inline-block; margin-left: 5px;">0.5 ï½ 3.0m</span><br>
        <div class="square" style='background-color: rgb(247, 245, 169); display: inline-block;'>
        </div><span style="display: inline-block; margin-left: 5px;">0.5mæœªæº€</span><br>
        <div><img src="location-pin.png" alt="æŒ‡å®šç·Šæ€¥é¿é›£å ´æ‰€" style="width:20px; height:20px;" />æŒ‡å®šç·Šæ€¥é¿é›£å ´æ‰€</div>
    </div>

    <div class="map-overlay top">
        <div class="map-overlay-inner">
            <label>ä¸é€æ˜åº¦</label>
            <label>æµ¸æ°´æ¨å®šå›³: <span id="shinsui-slider-opacity-value">100%</span></label>
            <input id="shinsui-slider-opacity" type="range" min="0" max="100" step="1" value="100">
            <label>æ´ªæ°´æµ¸æ°´æƒ³å®šåŒºåŸŸ: <span id="kouzui-slider-opacity-value">100%</span></label>
            <input id="kouzui-slider-opacity" type="range" min="0" max="100" step="1" value="100">
            <!--
            <label>é™°å½±èµ·ä¼å›³: <span id="inei-slider-opacity-value">50%</span></label>
            <input id="inei-slider-opacity" type="range" min="0" max="100" step="1" value="50">
            -->
        </div>
    </div>
    <script type="text/javascript">
        let protocol = new pmtiles.Protocol();
        maplibregl.addProtocol("pmtiles", protocol.tile);

        // æŒ‡å®šç·Šæ€¥é¿é›£å ´æ‰€
        let PM_Hinanbasho_URL = "https://xs489works.xsrv.jp/pmtiles-data/gsi/hinanbasho/hinanbasho_20230706.pmtiles";

        const p1 = new pmtiles.PMTiles(PM_Hinanbasho_URL)
        protocol.add(p1);

        const map = new maplibregl.Map({
            container: 'map',
            // style: 'building3d.json',
            style: 'std.json',
            // style: 'https://tile2.openstreetmap.jp/styles/osm-bright/style.json',
            zoom: 13.7,
            minZoom: 1,
            maxZoom: 23,
            pitch: 60,
            bearing: 0,
            center: [133.68457, 34.62465],
            hash: true,
            attributionControl: false
        });

        // ã‚ºãƒ¼ãƒ ãƒ»å›è»¢
        map.addControl(new maplibregl.NavigationControl());

        // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¢ãƒ¼ãƒ‰ã®ã‚ªãƒ³ã‚ªãƒ•
        map.addControl(new maplibregl.FullscreenControl());

        // ç¾åœ¨ä½ç½®è¡¨ç¤º
        map.addControl(new maplibregl.GeolocateControl({
            positionOptions: {
                enableHighAccuracy: false
            },
            fitBoundsOptions: { maxZoom: 18 },
            trackUserLocation: true,
            showUserLocation: true
        }));

        // ã‚¹ã‚±ãƒ¼ãƒ«è¡¨ç¤º
        map.addControl(new maplibregl.ScaleControl({
            maxWidth: 200,
            unit: 'metric'
        }));

        // Attributionã‚’æŠ˜ã‚ŠãŸãŸã¿è¡¨ç¤º
        map.addControl(new maplibregl.AttributionControl({
            compact: true,
            customAttribution: 'ï¼ˆ<a href="https://twitter.com/shi__works" target="_blank">Twitter</a> | <a href="https://github.com/shi-works/GSI-Provisional-Inundation-Depth-Map" target="_blank">Github</a>ï¼‰ '
        }));

        // 3Dåœ°å½¢ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
        map.addControl(
            new maplibregl.TerrainControl({
                source: 'gsidem',
                exaggeration: 1 // æ¨™é«˜ã‚’å¼·èª¿ã™ã‚‹å€ç‡
            })
        );

        map.on('load', () => {
            // æ¨™é«˜ã‚¿ã‚¤ãƒ«
            map.addSource("gsidem", {
                type: 'raster-dem',
                tiles: [
                    'gsidem://https://cyberjapandata.gsi.go.jp/xyz/dem_png/{z}/{x}/{y}.png',
                ],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html#dem" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«(æ¨™é«˜ã‚¿ã‚¤ãƒ«)</a>',
                tileSize: 256
            });

            // map.setTerrain({ 'source': 'gsidem', 'exaggeration': 1 });

            // é™°å½±èµ·ä¼å›³
            map.addSource("hillshade", {
                type: 'raster',
                tiles: [
                    'https://cyberjapandata.gsi.go.jp/xyz/hillshademap/{z}/{x}/{y}.png',
                ],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html#hillshademap" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«(é™°å½±èµ·ä¼å›³)</a>',
                tileSize: 256
            });

            map.addLayer({
                id: 'hillshade-tiles',
                type: 'raster',
                source: 'hillshade',
                minzoom: 2,
                maxzoom: 18,
                paint: {
                    'raster-opacity': 0.3
                }
            });

            /*
            // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§é™°å½±èµ·ä¼å›³ã®ä¸é€æ˜åº¦ã‚’åˆ¶å¾¡
            const inei_sliderOpactiy = document.getElementById('inei-slider-opacity');
            const inei_sliderOpactiyValue = document.getElementById('inei-slider-opacity-value');

            inei_sliderOpactiy.addEventListener('input', (e) => {
                map.setPaintProperty(
                    'hillshade-tiles',
                    'raster-opacity',
                    parseInt(e.target.value, 10) / 100
                );
                inei_sliderOpactiyValue.textContent = e.target.value + '%';
            });
            */

            // æ´ªæ°´æµ¸æ°´æƒ³å®šåŒºåŸŸï¼ˆæƒ³å®šæœ€å¤§è¦æ¨¡ï¼‰ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ«
            map.addSource("flood_l2_shinsuishin", {
                type: "raster",
                tiles: ["https://disaportaldata.gsi.go.jp/raster/01_flood_l2_shinsuishin_data/{z}/{x}/{y}.png"],
                tileSize: 256,
                "attribution": "<a href='https://disaportal.gsi.go.jp/hazardmap/copyright/opendata.html' target='_blank'>ãƒã‚¶ãƒ¼ãƒ‰ãƒãƒƒãƒ—ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆï¼ˆé‡ã­ã‚‹ãƒã‚¶ãƒ¼ãƒ‰ãƒãƒƒãƒ—ï¼‰</a>"
            });

            map.addLayer({
                id: "flood_l2_shinsuishin",
                type: "raster",
                source: "flood_l2_shinsuishin",
                minzoom: 6,
                maxzoom: 18,
                'paint': {
                    'raster-opacity': 1.0
                },
                'layout': {
                    'visibility': 'visible'
                }
            });

            // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§æ´ªæ°´æµ¸æ°´æƒ³å®šåŒºåŸŸï¼ˆæƒ³å®šæœ€å¤§è¦æ¨¡ï¼‰ã®ä¸é€æ˜åº¦ã‚’åˆ¶å¾¡
            const kouzui_sliderOpactiy = document.getElementById('kouzui-slider-opacity');
            const kouzui_sliderOpactiyValue = document.getElementById('kouzui-slider-opacity-value');

            kouzui_sliderOpactiy.addEventListener('input', (e) => {
                map.setPaintProperty(
                    'flood_l2_shinsuishin',
                    'raster-opacity',
                    parseInt(e.target.value, 10) / 100
                );
                kouzui_sliderOpactiyValue.textContent = e.target.value + '%';
            });

            // æµ¸æ°´æ¨å®šå›³ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ«
            map.addSource("gsi-shinsui", {
                type: "raster",
                tiles: [
                    "https://cyberjapandata.gsi.go.jp/xyz/201807H3007gouu_takahashigawa_dansaizu/{z}/{x}/{y}.png"
                ],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«(è¿‘å¹´ã®ç½å®³)</a>'
            });

            map.addLayer({
                id: 'gsi-shinsui-tiles',
                type: 'raster',
                source: 'gsi-shinsui',
                minzoom: 6,
                maxzoom: 18,
                paint: {
                    'raster-opacity': 1.0
                }
            });

            // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§æµ¸æ°´æ¨å®šå›³ã®ä¸é€æ˜åº¦ã‚’åˆ¶å¾¡
            const shinsui_sliderOpactiy = document.getElementById('shinsui-slider-opacity');
            const shinsui_sliderOpactiyValue = document.getElementById('shinsui-slider-opacity-value');

            shinsui_sliderOpactiy.addEventListener('input', (e) => {
                map.setPaintProperty(
                    'gsi-shinsui-tiles',
                    'raster-opacity',
                    parseInt(e.target.value, 10) / 100
                );
                shinsui_sliderOpactiyValue.textContent = e.target.value + '%';
            });

            // åœ°ç†é™¢åœ°å›³ãƒ™ã‚¯ãƒˆãƒ«ã‚¿ã‚¤ãƒ«
            map.addSource("gsibv-vectortile-source-1-4-16", {
                type: "vector",
                tiles: [
                    "https://cyberjapandata.gsi.go.jp/xyz/experimental_bvmap/{z}/{x}/{y}.pbf"
                ],
                attribution: '<a href="https://github.com/gsi-cyberjapan/gsivectortile-3d-like-building">åœ°ç†é™¢åœ°å›³Vectorï¼ˆä»®ç§°ï¼‰</a>'
            });

            // åœ°ç†é™¢åœ°å›³ãƒ™ã‚¯ãƒˆãƒ«ã‚¿ã‚¤ãƒ«
            // ã‚¿ãƒ³ã‚¯
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 13,
                "maxzoom": 18,
                "id": "buildings4302",
                "metadata": { "name": "ã‚¿ãƒ³ã‚¯" },
                "type": "fill-extrusion",
                "source-layer": "structurea",
                "filter": ["all", ["==", "ftCode", 4302], ["==", "$type", "Polygon"]],
                "paint": {
                    // "fill-extrusion-color": "rgb(0,100,150)",
                    "fill-extrusion-color": "rgb(242,234,226)",
                    "fill-extrusion-opacity": 0.8,
                    "fill-extrusion-height": 10
                }
            });

            // å·¨å¤§æ§‹é€ ç‰©
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 13,
                "maxzoom": 18,
                "id": "buildings4301",
                "metadata": { "name": "å·¨å¤§æ§‹é€ ç‰©" },
                "type": "fill-extrusion",
                "source-layer": "structurea",
                "filter": ["all", ["==", "ftCode", 4301], ["==", "$type", "Polygon"]],
                "paint": {
                    // "fill-extrusion-color": "rgb(0,100,150)",
                    "fill-extrusion-color": "rgb(242,234,226)",
                    "fill-extrusion-opacity": 0.8,
                    "fill-extrusion-height": 100
                }
            });

            // æ™®é€šç„¡å£èˆ
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 14,
                "maxzoom": 18,
                "id": "buildings3111",
                "metadata": { "name": "æ™®é€šç„¡å£èˆ" },
                "type": "fill-extrusion",
                "source-layer": "building",
                "filter": ["all", ["==", "ftCode", 3111], ["==", "$type", "Polygon"]],
                "paint": {
                    // "fill-extrusion-color": "rgb(0,100,150)",
                    "fill-extrusion-color": "rgb(242,234,226)",
                    "fill-extrusion-opacity": 0.5,
                    "fill-extrusion-height": 10
                }
            });

            // å …ã‚ã†ç„¡å£èˆ
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 13,
                "maxzoom": 18,
                "id": "buildings3112",
                "metadata": { "name": "å …ã‚ã†ç„¡å£èˆ" },
                "type": "fill-extrusion",
                "source-layer": "building",
                "filter": ["all", ["==", "ftCode", 3112], ["==", "$type", "Polygon"]],
                "paint": {
                    "fill-extrusion-color": "rgb(150,200,255)",
                    "fill-extrusion-opacity": 0.5,
                    "fill-extrusion-height": 40
                }
            });

            // æ™®é€šå»ºç‰©
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 14,
                "maxzoom": 18,
                "id": "buildings3101",
                "metadata": { "name": "æ™®é€šå»ºç‰©" },
                "type": "fill-extrusion",
                "source-layer": "building",
                "filter": ["all", ["==", "ftCode", 3101], ["==", "$type", "Polygon"]],
                "paint": {
                    // "fill-extrusion-color": "rgb(0,100,150)",
                    "fill-extrusion-color": "rgb(242,234,226)",
                    "fill-extrusion-opacity": 0.8,
                    "fill-extrusion-height": 10
                }
            });

            // å …ã‚ã†å»ºç‰©
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 13,
                "maxzoom": 18,
                "id": "buildings3102",
                "metadata": { "name": "å …ã‚ã†å»ºç‰©" },
                "type": "fill-extrusion",
                "source-layer": "building",
                "filter": ["all", ["==", "ftCode", 3102], ["==", "$type", "Polygon"]],
                "paint": {
                    "fill-extrusion-color": "rgb(150,200,255)",
                    "fill-extrusion-opacity": 0.8,
                    "fill-extrusion-height": 40
                }
            });

            // é«˜å±¤å»ºç‰©
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 13,
                "maxzoom": 18,
                "id": "buildings3103",
                "metadata": { "name": "é«˜å±¤å»ºç‰©" },
                "type": "fill-extrusion",
                "source-layer": "building",
                "filter": ["all", ["==", "ftCode", 3103], ["==", "$type", "Polygon"]],
                "paint": {
                    "fill-extrusion-color": "rgb(0,255,255)",
                    "fill-extrusion-opacity": 0.8,
                    "fill-extrusion-height": 100
                }
            });

            // æ³¨è¨˜-æ²³å·å
            map.addLayer({
                "type": "symbol",
                "id": "gsi-label-layer",
                "source": "gsibv-vectortile-source-1-4-16",
                "source-layer": "label",
                "minzoom": 11,
                "maxzoom": 16,
                "filter": ["all", ["==", "ftCode", 100], ["==", "annoCtg", 322]],
                "paint": {
                    'text-color': 'rgba(0, 101, 203, 1)',
                    "text-halo-color": "rgba(255, 255, 255, 1)",
                    "text-halo-width": 1.0
                },
                "layout": {
                    "text-size": 20,
                    "text-font": ["Open Sans Bold"],
                    "text-field": ["get", "knj"],
                    "symbol-placement": "point",
                    "text-allow-overlap": false,
                    "visibility": "visible"
                }
            });

            // æŒ‡å®šç·Šæ€¥é¿é›£å ´æ‰€ãƒ™ã‚¯ãƒˆãƒ«ã‚¿ã‚¤ãƒ«ï¼ˆPMTilesï¼‰
            map.addSource("pmtiles-hinan", {
                type: "vector",
                url: "pmtiles://" + PM_Hinanbasho_URL,
                attribution: '<a href="https://www.gsi.go.jp/bousaichiri/hinanbasho.html">æŒ‡å®šç·Šæ€¥é¿é›£å ´æ‰€ãƒ‡ãƒ¼ã‚¿ï¼ˆå›½åœŸåœ°ç†é™¢Webã‚µã‚¤ãƒˆï¼‰ã‚’åŠ å·¥ã—ã¦ä½œæˆ</a>'
            });

            map.loadImage('./location-pin.png', // location-pinã‚¢ã‚¤ã‚³ãƒ³ã®URLã‚’æŒ‡å®š
                function (error, image) {
                    if (error) throw error;
                    map.addImage('location-pin', image); // 'location-pin'ã¨ã„ã†åå‰ã§ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿½åŠ 
                }
            );

            // æŒ‡å®šç·Šæ€¥é¿é›£å ´æ‰€ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤
            map.addLayer({
                "id": "hinanbasho-1",
                "source": "pmtiles-hinan",
                "source-layer": "hinanbasho_20230706",
                "type": "symbol", // typeã‚’'symbol'ã«å¤‰æ›´
                "layout": {
                    "icon-image": "location-pin", // ä½¿ç”¨ã™ã‚‹ã‚¢ã‚¤ã‚³ãƒ³åã‚’æŒ‡å®š
                    // å¿…è¦ã«å¿œã˜ã¦ã€ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚µã‚¤ã‚ºã‚’èª¿æ•´ã™ã‚‹
                    "icon-size": 0.6 // ã‚¢ã‚¤ã‚³ãƒ³ã®å¤§ãã•ã‚’å¤‰æ›´ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
                }
            });

            // ãƒ•ã‚£ãƒ«ã‚¿è¨­å®š
            map.setFilter('hinanbasho-1', ['==', 'æ´ªæ°´', '1']);

            // map.showTileBoundaries = true;

        })

        // ãƒãƒƒãƒ—ã®ä¸­å¿ƒåº§æ¨™ã‚’è¨­å®š
        function getMapCenter(CenterText) {
            const CenterTable = {
                // ç·¯åº¦ã€çµŒåº¦ã€ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ã€ãƒ™ã‚¢ãƒªãƒ³ã‚°ã€ãƒ”ãƒƒãƒ
                // å¹³æˆ30å¹´7æœˆè±ªé›¨
                '201807H3007gouu_takahashigawa_dansaizu': [34.62465, 133.68457, 13.7, 0, 60],
                '201807H3007gouu_hijikawa_dansaizu': [33.532237, 132.572021, 14, 0, 60],
                // ä»¤å’Œå…ƒå¹´å°é¢¨ç¬¬19å·
                '20191012typhoon19_naruse_1014dansaizu': [38.44149, 141.00536, 12.5, 0, 60],
                '20191012typhoon19_abukuma_1014dansaizu': [37.85414, 140.57538, 13.7, 0, 60],
                '20191012typhoon19_shinano_1013dansaizu': [36.68515, 138.27631, 13.7, 0, 60],
                '20191012typhoon19_kuji_1014dansaizu': [36.518466, 140.460205, 14, 0, 60],
                '20191012typhoon19_naka_1014dansaizu': [36.43173, 140.42166, 13.4, 0, 60],
                '20191012typhoon19_arakawa_1014dansaizu': [35.951330, 139.449463, 14, 0, 60],
                // ä»¤å’Œå…ƒå¹´10æœˆã®ä½æ°—åœ§ã«ä¼´ã†å¤§é›¨
                '20191025oame_mobara_1028dansaizu_handoku': [35.415915, 140.306396, 14, 0, 60],
                // ä»¤å’Œ2å¹´7æœˆè±ªé›¨
                '20200703oame_kumagawahitoyoshi_0704dansaizu': [32.222096, 130.726318, 14, 0, 60],
                '20200703oame_kumagawa_0704dansaizu': [32.444885, 130.660400, 14, 0, 60],
                '20200703oame_sashikigawayunouragawaashikita_0704dansaizu': [32.296420, 130.484619, 14, 0, 60],
                '20200703oame_omuta_0707dansaizu': [33.0272, 130.4393, 14.2, 0, 60],
                '20200703oame_hita_0707dansaizu': [33.325939, 130.907593, 15, 0, 60],
                '20200703oame_miyama_0708dansaizu': [33.128351, 130.462646, 14, 0, 60],
                '20200703oame_chikugogawa_0709dansaizu': [33.33496, 130.56938, 12.6, 0, 60],
                '20200729rain_mogamigawa_0729dansaizu2': [38.45467, 140.3437, 13.9, 0, 60],
                '20230629rain_0711shinsui': [33.33496, 130.56938, 12.6, 0, 60],
            };
            return CenterTable[CenterText];
        }

        // PngTilesåˆ‡ã‚Šæ›¿ãˆè¡¨ç¤º
        function SelectPngTiles() {
            var PngTilesName = document.getElementById('pngtiles').value;

            // ä¸€æ—¦ã€ãƒ¬ã‚¤ãƒ¤å‰Šé™¤
            map.removeLayer('flood_l2_shinsuishin');
            map.removeLayer('gsi-shinsui-tiles');
            map.removeSource('gsi-shinsui');
            map.removeLayer('buildings4302');
            map.removeLayer('buildings4301');
            map.removeLayer('buildings3111');
            map.removeLayer('buildings3112');
            map.removeLayer('buildings3101');
            map.removeLayer('buildings3102');
            map.removeLayer('buildings3103');
            map.removeLayer('gsi-label-layer');
            map.removeLayer('hinanbasho-1');

            // å€¤ã‚’ç·¯åº¦ã€çµŒåº¦ã«ãã‚Œãã‚Œä»£å…¥
            const locationInfo = getMapCenter(PngTilesName);

            const latitude = locationInfo[0];
            const longitude = locationInfo[1];
            const zoomlevel = locationInfo[2];
            const bearing = locationInfo[3];
            const pitch = locationInfo[4];

            // ãƒãƒƒãƒ—ã®ä¸­å¿ƒåº§æ¨™ã¸é·ç§»
            map.flyTo({
                center: [longitude, latitude],
                zoom: zoomlevel,
                bearing: bearing,
                pitch: pitch
            });

            // æ´ªæ°´æµ¸æ°´æƒ³å®šåŒºåŸŸï¼ˆæƒ³å®šæœ€å¤§è¦æ¨¡ï¼‰ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ«
            map.addLayer({
                id: "flood_l2_shinsuishin",
                type: "raster",
                source: "flood_l2_shinsuishin",
                minzoom: 6,
                maxzoom: 18,
                'paint': {
                    'raster-opacity': 1.0
                },
                'layout': {
                    'visibility': 'visible'
                }
            });

            // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§æ´ªæ°´æµ¸æ°´æƒ³å®šåŒºåŸŸï¼ˆæƒ³å®šæœ€å¤§è¦æ¨¡ï¼‰ã®ä¸é€æ˜åº¦ã‚’åˆ¶å¾¡
            const kouzui_sliderOpactiy = document.getElementById('kouzui-slider-opacity');
            const kouzui_sliderOpactiyValue = document.getElementById('kouzui-slider-opacity-value');

            kouzui_sliderOpactiy.addEventListener('input', (e) => {
                map.setPaintProperty(
                    'flood_l2_shinsuishin',
                    'raster-opacity',
                    parseInt(e.target.value, 10) / 100
                );
                kouzui_sliderOpactiyValue.textContent = e.target.value + '%';
            });

            // æµ¸æ°´æ¨å®šå›³ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ«
            if (PngTilesName != '20230629rain_0711shinsui') {
                map.addSource("gsi-shinsui", {
                    type: "raster",
                    tiles: [
                        "https://cyberjapandata.gsi.go.jp/xyz/" + PngTilesName + "/{z}/{x}/{y}.png"
                    ],
                    attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«(è¿‘å¹´ã®ç½å®³)</a>'
                });
            } else if (PngTilesName === '20230629rain_0711shinsui') {
                map.addSource("gsi-shinsui", {
                    type: "raster",
                    tiles: [
                        "https://maps.gsi.go.jp/xyz/" + PngTilesName + "/{z}/{x}/{y}.png"
                    ],
                    attribution: '<a href="https://www.gsi.go.jp/BOUSAI/R5_0629_heavyrain.html">ä»¤å’Œ5å¹´(2023å¹´)6æœˆ29æ—¥ã‹ã‚‰ã®å¤§é›¨ã«é–¢ã™ã‚‹æƒ…å ±</a>'
                });
            }

            map.addLayer({
                id: 'gsi-shinsui-tiles',
                type: 'raster',
                source: 'gsi-shinsui',
                minzoom: 6,
                maxzoom: 18,
                paint: {
                    'raster-opacity': 1.0
                }
            });

            // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§æµ¸æ°´æ¨å®šå›³ã®ä¸é€æ˜åº¦ã‚’åˆ¶å¾¡
            const shinsui_sliderOpactiy = document.getElementById('shinsui-slider-opacity');
            const shinsui_sliderOpactiyValue = document.getElementById('shinsui-slider-opacity-value');

            shinsui_sliderOpactiy.addEventListener('input', (e) => {
                map.setPaintProperty(
                    'gsi-shinsui-tiles',
                    'raster-opacity',
                    parseInt(e.target.value, 10) / 100
                );
                shinsui_sliderOpactiyValue.textContent = e.target.value + '%';
            });

            // åœ°ç†é™¢åœ°å›³ãƒ™ã‚¯ãƒˆãƒ«ã‚¿ã‚¤ãƒ«
            // ã‚¿ãƒ³ã‚¯
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 13,
                "maxzoom": 18,
                "id": "buildings4302",
                "metadata": { "name": "ã‚¿ãƒ³ã‚¯" },
                "type": "fill-extrusion",
                "source-layer": "structurea",
                "filter": ["all", ["==", "ftCode", 4302], ["==", "$type", "Polygon"]],
                "paint": {
                    // "fill-extrusion-color": "rgb(0,100,150)",
                    "fill-extrusion-color": "rgb(242,234,226)",
                    "fill-extrusion-opacity": 0.8,
                    "fill-extrusion-height": 10
                }
            });

            // å·¨å¤§æ§‹é€ ç‰©
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 13,
                "maxzoom": 18,
                "id": "buildings4301",
                "metadata": { "name": "å·¨å¤§æ§‹é€ ç‰©" },
                "type": "fill-extrusion",
                "source-layer": "structurea",
                "filter": ["all", ["==", "ftCode", 4301], ["==", "$type", "Polygon"]],
                "paint": {
                    // "fill-extrusion-color": "rgb(0,100,150)",
                    "fill-extrusion-color": "rgb(242,234,226)",
                    "fill-extrusion-opacity": 0.8,
                    "fill-extrusion-height": 100
                }
            });

            // æ™®é€šç„¡å£èˆ
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 14,
                "maxzoom": 18,
                "id": "buildings3111",
                "metadata": { "name": "æ™®é€šç„¡å£èˆ" },
                "type": "fill-extrusion",
                "source-layer": "building",
                "filter": ["all", ["==", "ftCode", 3111], ["==", "$type", "Polygon"]],
                "paint": {
                    // "fill-extrusion-color": "rgb(0,100,150)",
                    "fill-extrusion-color": "rgb(242,234,226)",
                    "fill-extrusion-opacity": 0.5,
                    "fill-extrusion-height": 10
                }
            });

            // å …ã‚ã†ç„¡å£èˆ
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 13,
                "maxzoom": 18,
                "id": "buildings3112",
                "metadata": { "name": "å …ã‚ã†ç„¡å£èˆ" },
                "type": "fill-extrusion",
                "source-layer": "building",
                "filter": ["all", ["==", "ftCode", 3112], ["==", "$type", "Polygon"]],
                "paint": {
                    "fill-extrusion-color": "rgb(150,200,255)",
                    "fill-extrusion-opacity": 0.5,
                    "fill-extrusion-height": 40
                }
            });

            // æ™®é€šå»ºç‰©
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 14,
                "maxzoom": 18,
                "id": "buildings3101",
                "metadata": { "name": "æ™®é€šå»ºç‰©" },
                "type": "fill-extrusion",
                "source-layer": "building",
                "filter": ["all", ["==", "ftCode", 3101], ["==", "$type", "Polygon"]],
                "paint": {
                    // "fill-extrusion-color": "rgb(0,100,150)",
                    "fill-extrusion-color": "rgb(242,234,226)",
                    "fill-extrusion-opacity": 0.8,
                    "fill-extrusion-height": 10
                }
            });

            // å …ã‚ã†å»ºç‰©
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 13,
                "maxzoom": 18,
                "id": "buildings3102",
                "metadata": { "name": "å …ã‚ã†å»ºç‰©" },
                "type": "fill-extrusion",
                "source-layer": "building",
                "filter": ["all", ["==", "ftCode", 3102], ["==", "$type", "Polygon"]],
                "paint": {
                    "fill-extrusion-color": "rgb(150,200,255)",
                    "fill-extrusion-opacity": 0.8,
                    "fill-extrusion-height": 40
                }
            });

            // é«˜å±¤å»ºç‰©
            map.addLayer({
                "source": "gsibv-vectortile-source-1-4-16",
                "minzoom": 13,
                "maxzoom": 18,
                "id": "buildings3103",
                "metadata": { "name": "é«˜å±¤å»ºç‰©" },
                "type": "fill-extrusion",
                "source-layer": "building",
                "filter": ["all", ["==", "ftCode", 3103], ["==", "$type", "Polygon"]],
                "paint": {
                    "fill-extrusion-color": "rgb(0,255,255)",
                    "fill-extrusion-opacity": 0.8,
                    "fill-extrusion-height": 100
                }
            });

            // æ³¨è¨˜-æ²³å·å
            map.addLayer({
                "type": "symbol",
                "id": "gsi-label-layer",
                "source": "gsibv-vectortile-source-1-4-16",
                "source-layer": "label",
                "minzoom": 11,
                "maxzoom": 16,
                "filter": ["all", ["==", "ftCode", 100], ["==", "annoCtg", 322]],
                "paint": {
                    'text-color': 'rgba(0, 101, 203, 1)',
                    "text-halo-color": "rgba(255, 255, 255, 1)",
                    "text-halo-width": 1.0
                },
                "layout": {
                    "text-size": 20,
                    "text-font": ["Open Sans Bold"],
                    "text-field": ["get", "knj"],
                    "symbol-placement": "point",
                    "text-allow-overlap": false,
                    "visibility": "visible"
                }
            });

            // æŒ‡å®šç·Šæ€¥é¿é›£å ´æ‰€ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤
            map.addLayer({
                "id": "hinanbasho-1",
                "source": "pmtiles-hinan",
                "source-layer": "hinanbasho_20230706",
                "type": "symbol", // typeã‚’'symbol'ã«å¤‰æ›´
                "layout": {
                    "icon-image": "location-pin", // ä½¿ç”¨ã™ã‚‹ã‚¢ã‚¤ã‚³ãƒ³åã‚’æŒ‡å®š
                    // å¿…è¦ã«å¿œã˜ã¦ã€ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚µã‚¤ã‚ºã‚’èª¿æ•´ã™ã‚‹
                    "icon-size": 0.6 // ã‚¢ã‚¤ã‚³ãƒ³ã®å¤§ãã•ã‚’å¤‰æ›´ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
                }
            });

            // ãƒ•ã‚£ãƒ«ã‚¿è¨­å®š
            map.setFilter('hinanbasho-1', ['==', 'æ´ªæ°´', '1']);

        }

        // æŒ‡å®šç·Šæ€¥é¿é›£å ´æ‰€ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        map.on('click', 'hinanbasho-1', (e) => {
            var lng = e.lngLat.lng;
            var lat = e.lngLat.lat;
            var jusho = e.features[0].properties['ä½æ‰€'];
            var shisetsumei = e.features[0].properties['æ–½è¨­ãƒ»å ´æ‰€å'];
            var chofuku = e.features[0].properties['æŒ‡å®šé¿é›£æ‰€ã¨ã®ä½æ‰€åŒä¸€'];

            var SyubetuIds = ["æ´ªæ°´", "å´–å´©ã‚Œã€åœŸçŸ³æµåŠã³åœ°æ»‘ã‚Š", "é«˜æ½®", "æ´¥æ³¢", "å¤§è¦æ¨¡ãªç«äº‹", "å†…æ°´æ°¾æ¿«", "ç«å±±ç¾è±¡"];
            var SyubetuMei = ''
            for (var j = 0; j < SyubetuIds.length; j++) {

                if (e.features[0].properties[SyubetuIds[j]] === '1') {
                    SyubetuMei += SyubetuIds[j] + "ã€€"
                }
            }

            if (chofuku === '1') { res_chofuku = "ã€‡"; } else { res_chofuku = "-"; }

            new maplibregl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(
                    '<b>' + '<big>' + '<font color="red">' + shisetsumei + '</font>' + '</big>' + '</b>' + '<br>'
                    + 'ä½æ‰€: ' + jusho + '<br>'
                    + '<a href=\https://www.google.com/maps?q=' + lat + "," + lng + "&hl=ja' target='_blank'>ğŸŒGoogle Maps</a>"
                    + '<br><br>'
                    + '<b>' + '<big>' + 'å¯¾å¿œã—ã¦ã„ã‚‹ç½å®³ã®ç¨®åˆ¥' + '</big>' + '</b>' + '<br>' + SyubetuMei + '<br><br>'
                    + 'æŒ‡å®šé¿é›£æ‰€ã¨ã®ä½æ‰€åŒä¸€: ' + res_chofuku + '<br><br>'
                    + '<b>' + 'â€»æœ€æ–°ã‹ã¤è©³ç´°ã®çŠ¶æ³ãªã©ã¯å¿…ãšå½“è©²å¸‚ç”ºæ‘ã«ã”ç¢ºèªãã ã•ã„ã€‚' + '</b>' + '<br>'
                    + '<a href=https://www.gsi.go.jp/bousaichiri/hinanbasho.html>ã€ŒæŒ‡å®šç·Šæ€¥é¿é›£å ´æ‰€ã€ã«ã¤ã„ã¦</a>')
                .addTo(map);

        });
    </script>
</body>

</html>